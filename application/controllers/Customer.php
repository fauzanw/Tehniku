<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Customer extends CI_Controller {

	/**
	*	 Generated by Generator
	**/

	public function index()
	{
		$perusahaan = $this->db->get_where('customer', ["user_id" => $this->session->userdata('id')])->row_array();
		$data = [
			'title'             => 'Dashboard',
			'title_main_header' => 'Dashboard',
			'data_customer'   => $perusahaan,
			'data_customer2'  => $this->session->userdata()
		];
		$this->load->view('customer/header', $data);
		$this->load->view('customer/navigator', $data);
		$this->load->view('customer/main_header', $data);
		$this->load->view('customer/index', $data);
		$this->load->view('customer/footer', $data);
	}

	public function pakejasa()
	{
		$customer = $this->db->get_where('customer', ["user_id" => $this->session->userdata('id')])->row_array();
		$data = [
			'title'             => 'Dashboard',
			'title_main_header' => 'Dashboard',
			'data_customer'     => $customer,
			'data_customer2'    => $this->session->userdata(),
			'data_perusahaan'   => [
				$this->db->get('perusahaan')->result_array(),
				'jarak' => []
			]
		];
		if(isset($_POST['latlon'])) {
			foreach($data['data_perusahaan'][0] as $data_perusahaan) {
				$latlon_perusahaan = explode(", ", $data_perusahaan['latlon']);
				$latlon_customer   = explode(", ", $_POST['latlon']);
				array_push($data['data_perusahaan']['jarak'], hitungJarak($latlon_perusahaan[0], $latlon_perusahaan[1],$latlon_customer[0], $latlon_customer[1]) . " Km");
			}	
		}else{
			foreach($data['data_perusahaan'][0] as $data_perusahaan) {
				$latlon_perusahaan = explode(", ", $data_perusahaan['latlon']);
				$latlon_customer   = explode(", ", $data['data_customer']['latlon']);
				array_push($data['data_perusahaan']['jarak'], hitungJarak($latlon_perusahaan[0], $latlon_perusahaan[1],$latlon_customer[0], $latlon_customer[1]) . " Km");
			}
		}

		$this->load->view('customer/header', $data);
		$this->load->view('customer/navigator', $data);
		$this->load->view('customer/main_header', $data);
		$this->load->view('customer/pakejasa', $data);
		$this->load->view('customer/footer', $data);
	}

	public function setting() 
	{
		
	}

}

?>